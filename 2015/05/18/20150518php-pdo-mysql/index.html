<!DOCTYPE html><html><head><meta name="generator" content="Hexo 3.8.0"><meta http-equiv="content-type" content="text/html; charset=utf-8"><meta content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0" name="viewport"><meta content="yes" name="apple-mobile-web-app-capable"><meta content="black-translucent" name="apple-mobile-web-app-status-bar-style"><meta content="telephone=no" name="format-detection"><meta name="description"><title>采用PDO对象和MySQL进行交互 | Welcome to May's Blog</title><link rel="stylesheet" type="text/css" href="/css/normalize.css"><link rel="stylesheet" type="text/css" href="/css/highlight.css"><link rel="stylesheet" type="text/css" href="/css/very-simple.css"><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/font-awesome/4.5.0/css/font-awesome.min.css"><link rel="Shortcut Icon" type="image/x-icon" href="/favicon.ico"></head><body><!-- include the sidebar--><!-- include ./includes/sidebar.jade--><!-- Blog title and subtitle--><header><div class="container header"><a id="logo" href="/." class="title">Welcome to May's Blog</a><span class="subtitle"></span><label id="toggle-menu" for="menu" onclick=""><i class="fa fa-bars"></i></label></div></header><!-- use checkbox hack for toggle nav-bar on small screens--><input id="menu" type="checkbox"><!-- Navigation Links--><nav id="nav"><div class="container"><a href="/" class="sidebar-nav-item active">Home</a><a href="/archives" class="sidebar-nav-item">Archives</a></div></nav><div id="header-margin-bar"></div><!-- gallery that comes before the header--><div class="wrapper"><div class="container post-header"><h1>采用PDO对象和MySQL进行交互</h1></div></div><div class="wrapper"><div class="container meta"><div class="post-time">2015-05-18</div><div class="post-categories"><a class="post-category-link" href="/categories/Study/">Study</a></div><div class="post-tags"><a class="post-tag-link" href="/tags/MySQL/">MySQL</a>/<a class="post-tag-link" href="/tags/PDO/">PDO</a>/<a class="post-tag-link" href="/tags/PHP/">PHP</a></div></div></div><article><div class="container post"><p>最近开始自己着手写一个小的项目,采用PHP+MySQL那一套进行编写。所以说，项目一开始便是连接数据库。之前我只了解过通过mysql_connect函数进行连接，这绝对是最低档次的连接数据库，之后知道了一个PDO对象这么个专门处理和数据库之间操作的对象，简直就和发现了新大陆一样。</p>
<blockquote>
<h2 id="创建PDO对象"><a href="#创建PDO对象" class="headerlink" title="创建PDO对象"></a>创建PDO对象</h2></blockquote>
<p>创建PDO对象一般需要三个参数，第一个参数则是要连接数据库的基本信息，包括数据库的IP地址和数据库的名称，第二个参数则是进入数据库的用户名，第三个就是进入密码。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$dbn = <span class="string">"mysql:host="</span> . DB_HOST . <span class="string">";charset=utf8;dbname="</span> . DB_NAME;</span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">	$db = <span class="keyword">new</span> PDO($dbn, DB_USER, DB_PASS);</span><br><span class="line">&#125; <span class="keyword">catch</span> (<span class="keyword">Exception</span> $e) &#123;</span><br><span class="line">	<span class="keyword">die</span>($e-&gt;getMessage());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>DB_HOST: 数据库的IP地址，本地数据库的话则是<code>localhost</code></li>
<li>DB_NAME: 数据库的名字</li>
<li>DB_USER: 登录的用户名</li>
<li>DB_PASS: 登录密码</li>
</ul>
<blockquote>
<h2 id="SQL语句准备"><a href="#SQL语句准备" class="headerlink" title="SQL语句准备"></a>SQL语句准备</h2></blockquote>
<p>这里以event表为例，以下为表的结构</p>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">+<span class="comment">-------------+-------------+------+-----+---------------------+----------------+</span></span><br><span class="line">| Field       | Type        | Null | Key | Default             | Extra          |</span><br><span class="line">+<span class="comment">-------------+-------------+------+-----+---------------------+----------------+</span></span><br><span class="line">| event_id    | int(11)     | NO   | PRI | NULL                | auto_increment |</span><br><span class="line">| event_title | varchar(80) | YES  |     | NULL                |                |</span><br><span class="line">| event_desc  | text        | YES  |     | NULL                |                |</span><br><span class="line">| event_start | timestamp   | NO   | MUL | 0000-00-00 00:00:00 |                |</span><br><span class="line">| event_end   | timestamp   | NO   |     | 0000-00-00 00:00:00 |                |</span><br><span class="line">+<span class="comment">-------------+-------------+------+-----+---------------------+----------------+</span></span><br></pre></td></tr></table></figure>
<p>若SQL中带有php中的参数，一种可以直接在以<code>{$param}</code>的形式将值传进去，但是这样类型不好控制，还有一种弊病就是容易被SQL注入。所以还有一种则是采用PDO对象附带的参数绑定函数，这样那么对应的SQL语句就需要占位符，好处就是可以在一定程度上避免被sql注入，还可以使用预处理语句，这样运行的效率更高。占位符大致可分为以下两类。</p>
<h3 id="1、命名参数"><a href="#1、命名参数" class="headerlink" title="1、命名参数"></a>1、命名参数</h3><p>需自定义一个字符串作为“命名参数”，每个参数前需要冒号开始</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"select * from event where `event_id`=:id and `event_title`=:title"</span>;</span><br></pre></td></tr></table></figure>
<h3 id="2、问号参数"><a href="#2、问号参数" class="headerlink" title="2、问号参数"></a>2、问号参数</h3><p>问号参数一定要和字段的位置顺序对应。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"select * from event where `event_id`=? and `event_title`=?"</span>;</span><br></pre></td></tr></table></figure>
<blockquote>
<h2 id="交互操作"><a href="#交互操作" class="headerlink" title="交互操作"></a>交互操作</h2></blockquote>
<p>前期的准备都已经OK了，那么接下来就开始和数据库进行交互了</p>
<h3 id="1、准备语句"><a href="#1、准备语句" class="headerlink" title="1、准备语句"></a>1、准备语句</h3><p>使用<code>prepare()</code>函数准备预处理语句，该函数返回PDO对象。当重复执行一个sql查询，只是参数不一样的时候，这时候使用预处理效力最高，上面写的两种sql语句准备都是在做预处理，占位符的作用就是用来空出参数的位置。</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$stmt = $db-&gt;prepare($sql);</span><br></pre></td></tr></table></figure>
<p>参数绑定一种可以用到<code>bindParam()</code>函数，具体函数的句法如下</p>
<p><code>boolean PDOStatement::bindParam(mixed parameter,mixed &amp;variable[,int datatype[,int length[,mixed driver_options]]])；</code></p>
<ul>
<li>parameter 预处理语句中指定列值占位符的名字</li>
<li>variable 赋予占位符的引用值</li>
<li>datatype 显示设置参数的SQL数据类型 <blockquote>
<p>PDO::PARAM_BOOL：SQL BOOLEAN类型。<br>PDO::PARAM_INPUT_OUTPUT：参数传递给存储过程时使用此类型，因此，可以在过程执行后修改。<br>PDO::PARAM_INT：SQL INTEGER数据类型。<br>PDO::PARAM_NULL：SQL NULL数据类型。<br>PDO::PARAM_LOB：SQL大对象数据类型。<br>PDO::PARAM_STMT：PDOStatement对象类型，当前不可操作。<br>PDO::PARAM_STR：SQL CHAR、VARCHAR和其它字符串数据类型。</p>
</blockquote>
</li>
<li>length 指定数据类型长度，只有当赋值为PDO_PARAM_INPUT_OUTPUT才需要</li>
<li>driver_option 传递任何数据库驱动产徐特定选项</li>
</ul>
<p>上代码<br></p>
<ul>
<li>占位符为命名参数</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$stmt-&gt;bindParam(<span class="string">":id"</span>, $id, PDO::PARAM_INT);</span><br><span class="line">$stmt-&gt;bindParam(<span class="string">":title"</span>, $title, PDO::PARAM_STR);</span><br></pre></td></tr></table></figure>
<ul>
<li>占位符为问号参数形式</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$stmt-&gt;bindParam(<span class="number">1</span>, $id, PDO::PARAM_INT);</span><br><span class="line">$stmt-&gt;bindParam(<span class="number">2</span>, $title, PDO::PARAM_STR);</span><br></pre></td></tr></table></figure>
<p>还有一种参数绑定的形式则是直接在execute函数里面添加参数列表，详细见下</p>
<h3 id="3、执行"><a href="#3、执行" class="headerlink" title="3、执行"></a>3、执行</h3><p><code>execute([array])</code>方法负责执行准备好的查询，需要替换占位符。一种则是用bindParam函数替换，还有一种则是直接在execute函数中输入array表示。</p>
<h3 id="4、获取数据"><a href="#4、获取数据" class="headerlink" title="4、获取数据"></a>4、获取数据</h3><p>如果执行的是查询语句的话，就得获取从数据库中查询的数据。下面两个函数是我比较常用的。</p>
<ul>
<li><p>fetch() 将结果集中当前记录返回，并将结果指针移至下一条记录，也就是一条一条返回。<br>函数原型为<br><code>mixed PDOStatement::fetch ([ int $fetch_style [, int $cursor_orientation = PDO::FETCH_ORI_NEXT [, int $cursor_offset = 0 ]]] )</code></p>
</li>
<li><p>fetchAll()  返回所有搜索结果。<br>函数原型为<br><code>array PDOStatement::fetchAll ([ int $fetch_style [, mixed $fetch_argument [, array $ctor_args = array() ]]] )</code><br>函数返回一个包含结果集中的所有行的二维数组</p>
</li>
</ul>
<p>这两个函数的参数基本相同，下面一一介绍。</p>
<ul>
<li>PDO::FETCH_ASSOC: 返回一个索引为结果集列名的数组<br>以<code>select * from event</code>为例，则搜索的结果var_dump之后为</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">array(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  array(<span class="number">5</span>) &#123;</span><br><span class="line">    [<span class="string">"event_id"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"1"</span></span><br><span class="line">    [<span class="string">"event_title"</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"New Year's Day"</span></span><br><span class="line">    [<span class="string">"event_desc"</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"Happy New Year"</span></span><br><span class="line">    [<span class="string">"event_start"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 00:00:00"</span></span><br><span class="line">    [<span class="string">"event_end"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 23:59:59"</span></span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  array(<span class="number">5</span>) &#123;</span><br><span class="line">    [<span class="string">"event_id"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"3"</span></span><br><span class="line">    [<span class="string">"event_title"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"Middle of the Mouth"</span></span><br><span class="line">    [<span class="string">"event_desc"</span>]=&gt;</span><br><span class="line">    string(<span class="number">25</span>) <span class="string">"The Middle of the January"</span></span><br><span class="line">    [<span class="string">"event_start"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 00:00:00"</span></span><br><span class="line">    [<span class="string">"event_end"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 23:59:59"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>PDO::FETCH_BOTH(默认): 返回一个索引为结果集列名和以0开始的列号的数组<br>以<code>select * from event</code>为例，则搜索的结果var_dump之后为</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br></pre></td><td class="code"><pre><span class="line">array(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  array(<span class="number">10</span>) &#123;</span><br><span class="line">    [<span class="string">"event_id"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"1"</span></span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"1"</span></span><br><span class="line">    [<span class="string">"event_title"</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"New Year's Day"</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"New Year's Day"</span></span><br><span class="line">    [<span class="string">"event_desc"</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"Happy New Year"</span></span><br><span class="line">    [<span class="number">2</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"Happy New Year"</span></span><br><span class="line">    [<span class="string">"event_start"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 00:00:00"</span></span><br><span class="line">    [<span class="number">3</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 00:00:00"</span></span><br><span class="line">    [<span class="string">"event_end"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 23:59:59"</span></span><br><span class="line">    [<span class="number">4</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 23:59:59"</span></span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  array(<span class="number">10</span>) &#123;</span><br><span class="line">    [<span class="string">"event_id"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"3"</span></span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"3"</span></span><br><span class="line">    [<span class="string">"event_title"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"Middle of the Mouth"</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"Middle of the Mouth"</span></span><br><span class="line">    [<span class="string">"event_desc"</span>]=&gt;</span><br><span class="line">    string(<span class="number">25</span>) <span class="string">"The Middle of the January"</span></span><br><span class="line">    [<span class="number">2</span>]=&gt;</span><br><span class="line">    string(<span class="number">25</span>) <span class="string">"The Middle of the January"</span></span><br><span class="line">    [<span class="string">"event_start"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 00:00:00"</span></span><br><span class="line">    [<span class="number">3</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 00:00:00"</span></span><br><span class="line">    [<span class="string">"event_end"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 23:59:59"</span></span><br><span class="line">    [<span class="number">4</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 23:59:59"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>PDO::FETCH_BOUND: 返回TRUE，并分配结果集中的列值给mentPDOStatement::bindColumn()方法绑定PHP变量。<br>以<code>select</code>event_id<code>,</code>event_title<code>from event</code>为例，只不过代码与之前有些不同。</li>
</ul>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$stmt-&gt;bindColumn(<span class="string">'event_id'</span>, $id);</span><br><span class="line">$stmt-&gt;bindColumn(<span class="string">'event_title'</span>, $title);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span>($stmt-&gt;fetch(PDO::FETCH_BOUND)) &#123;</span><br><span class="line">	<span class="keyword">echo</span> $id . <span class="string">"\t"</span> . $title . <span class="string">"\n"</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以下为输出结果</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">1</span>	New Year<span class="string">'s Day</span></span><br><span class="line"><span class="string">3	Middle of the Mouth</span></span><br></pre></td></tr></table></figure>
<ul>
<li>PDO::FETCH_CLASS: 返回一个请求类的新实例，映射结果集中的列名到类中对应的属性名。如果 fetch_style 包含 PDO::FETCH_CLASSTYPE（例如：PDO::FETCH_CLASS | PDO::FETCH_CLASSTYPE），则类名由第一列的值决定<br>以<code>select * from event</code>为例，则搜索的结果var_dump之后为</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">array(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  object(stdClass)#4 (5) &#123;</span><br><span class="line">    [<span class="string">"event_id"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"1"</span></span><br><span class="line">    [<span class="string">"event_title"</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"New Year's Day"</span></span><br><span class="line">    [<span class="string">"event_desc"</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"Happy New Year"</span></span><br><span class="line">    [<span class="string">"event_start"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 00:00:00"</span></span><br><span class="line">    [<span class="string">"event_end"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 23:59:59"</span></span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  object(stdClass)#5 (5) &#123;</span><br><span class="line">    [<span class="string">"event_id"</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"3"</span></span><br><span class="line">    [<span class="string">"event_title"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"Middle of the Mouth"</span></span><br><span class="line">    [<span class="string">"event_desc"</span>]=&gt;</span><br><span class="line">    string(<span class="number">25</span>) <span class="string">"The Middle of the January"</span></span><br><span class="line">    [<span class="string">"event_start"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 00:00:00"</span></span><br><span class="line">    [<span class="string">"event_end"</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 23:59:59"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>PDO::FETCH_NUM: 返回一个索引为以0开始的结果集列号的数组<br>以<code>select * from event</code>为例，则搜索的结果var_dump之后为</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">array(<span class="number">3</span>) &#123;</span><br><span class="line">  [<span class="number">0</span>]=&gt;</span><br><span class="line">  array(<span class="number">5</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"1"</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"New Year's Day"</span></span><br><span class="line">    [<span class="number">2</span>]=&gt;</span><br><span class="line">    string(<span class="number">14</span>) <span class="string">"Happy New Year"</span></span><br><span class="line">    [<span class="number">3</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 00:00:00"</span></span><br><span class="line">    [<span class="number">4</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-01 23:59:59"</span></span><br><span class="line">  &#125;</span><br><span class="line">  [<span class="number">1</span>]=&gt;</span><br><span class="line">  array(<span class="number">5</span>) &#123;</span><br><span class="line">    [<span class="number">0</span>]=&gt;</span><br><span class="line">    string(<span class="number">1</span>) <span class="string">"3"</span></span><br><span class="line">    [<span class="number">1</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"Middle of the Mouth"</span></span><br><span class="line">    [<span class="number">2</span>]=&gt;</span><br><span class="line">    string(<span class="number">25</span>) <span class="string">"The Middle of the January"</span></span><br><span class="line">    [<span class="number">3</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 00:00:00"</span></span><br><span class="line">    [<span class="number">4</span>]=&gt;</span><br><span class="line">    string(<span class="number">19</span>) <span class="string">"2015-01-16 23:59:59"</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>接下来的我用的不怎么多，简单介绍下</p>
<ul>
<li>PDO::FETCH_INFO: 更新一个被请求类已存在的实例，映射结果集中的列到类中命名的属性</li>
<li>PDO::FETCH_LAZY: 结合使用 PDO::FETCH_BOTH 和 PDO::FETCH_OBJ，创建供用来访问的对象变量名</li>
<li>PDO::FETCH_OBJ: 返回一个属性名对应结果集列名的匿名对象</li>
</ul>
<h3 id="5、释放"><a href="#5、释放" class="headerlink" title="5、释放"></a>5、释放</h3><p><code>bool PDOStatement::closeCursor ( void )</code>释放到数据库服务的连接，以便发出其他SQL语句，但使语句处于一个可以被再次执行的状态。<br>等同于以下代码</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span> &#123;</span><br><span class="line">	<span class="keyword">while</span> ($stmt-&gt;fetch());</span><br><span class="line">	<span class="keyword">if</span> (!$stmt-&gt;nextRowset())	<span class="keyword">break</span>;</span><br><span class="line">&#125; <span class="keyword">while</span> (<span class="keyword">true</span>);</span><br></pre></td></tr></table></figure>
<blockquote>
<h2 id="代码整合"><a href="#代码整合" class="headerlink" title="代码整合"></a>代码整合</h2></blockquote>
<p>总结上面，写一下完整的过程</p>
<h3 id="1、带命名参数占位符"><a href="#1、带命名参数占位符" class="headerlink" title="1、带命名参数占位符"></a>1、带命名参数占位符</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$dbn = <span class="string">"mysql:host="</span> . DB_HOST . <span class="string">";charset=utf8;dbname="</span> . DB_NAME;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	$db = <span class="keyword">new</span> PDO($dbn, DB_USER, DB_PASS);</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">	<span class="keyword">die</span>($e-&gt;getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select * from `event` where `event_id`=:id and `event_title`=:title"</span>; </span><br><span class="line">$stmt = $db-&gt;prepare($sql);</span><br><span class="line"></span><br><span class="line">$stmt-&gt;bindParam(<span class="string">":id"</span>, $id, PDO::PARAM_INT);</span><br><span class="line">$stmt-&gt;bindParam(<span class="string">":title"</span>, $title, PDO::PARAM_STR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($stmt-&gt;execute() == <span class="keyword">false</span>)&#123;	</span><br><span class="line">	<span class="comment">//运行报错处理，多半是语法错误</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$results = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC);  <span class="comment">//$result存储返回的数据</span></span><br><span class="line"></span><br><span class="line">$stmt-&gt;closeCursor();</span><br></pre></td></tr></table></figure>
<h3 id="2、带问号参数占位符"><a href="#2、带问号参数占位符" class="headerlink" title="2、带问号参数占位符"></a>2、带问号参数占位符</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">$dbn = <span class="string">"mysql:host="</span> . DB_HOST . <span class="string">";charset=utf8;dbname="</span> . DB_NAME;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	$db = <span class="keyword">new</span> PDO($dbn, DB_USER, DB_PASS);</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">	<span class="keyword">die</span>($e-&gt;getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select * from `event` where `event_id`=? and `event_title`=?"</span>; </span><br><span class="line">$stmt = $db-&gt;prepare($sql);</span><br><span class="line"></span><br><span class="line">$stmt-&gt;bindParam(<span class="number">1</span>, $id, PDO::PARAM_INT);</span><br><span class="line">$stmt-&gt;bindParam(<span class="number">2</span>, $title, PDO::PARAM_STR);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($stmt-&gt;execute() == <span class="keyword">false</span>)&#123;</span><br><span class="line">	<span class="comment">//运行报错处理，多半是语法错误</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$results = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC); <span class="comment">//$result存储返回的数据</span></span><br><span class="line"></span><br><span class="line">$stmt-&gt;closeCursor();</span><br></pre></td></tr></table></figure>
<p>还有一种则是不用bindParam()函数绑定参数，不过这种方法只能使用问号参数占位符，还有啊，个人感觉这种方法会让安全性降低= =</p>
<figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$dbn = <span class="string">"mysql:host="</span> . DB_HOST . <span class="string">";charset=utf8;dbname="</span> . DB_NAME;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>&#123;</span><br><span class="line">	$db = <span class="keyword">new</span> PDO($dbn, DB_USER, DB_PASS);</span><br><span class="line">&#125;<span class="keyword">catch</span>(<span class="keyword">Exception</span> $e)&#123;</span><br><span class="line">	<span class="keyword">die</span>($e-&gt;getMessage());</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$sql = <span class="string">"select * from `event` where `event_id`=? and `event_title`=?"</span>; </span><br><span class="line">$stmt = $db-&gt;prepare($sql);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($stmt-&gt;execute(<span class="keyword">array</span>($id, $title)) == <span class="keyword">false</span>)&#123;</span><br><span class="line">	<span class="comment">//运行报错处理，多半是语法错误</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$results = $stmt-&gt;fetchAll(PDO::FETCH_ASSOC); <span class="comment">//$result存储返回的数据</span></span><br><span class="line"></span><br><span class="line">$stmt-&gt;closeCursor();</span><br></pre></td></tr></table></figure>
<p>这就是一套基本的交互过程，不过本文以查询为例，插入和删除也是同样的，只是没有了获取数据这一过程。</p>
<p>The End~</p>
</div><!-- comment system--><div class="container"><hr><div id="disqus_thread"></div><script type="text/javascript">
var disqus_shortname = 'maywanting';
var disqus_identifier = '2015/05/18/20150518php-pdo-mysql/';
var disqus_title = '采用PDO对象和MySQL进行交互';
var disqus_url = 'http://maywanting.wang/2015/05/18/20150518php-pdo-mysql/';
(function() {
   var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
   dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
   (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
})();
</script>
<noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="http://disqus.com" class="dsq-brlink">Blog comments powered by <span class="logo-disqus">Disqus</span></a></div></article><footer id="footer"><div class="container"><div class="bar"><div class="social"><a href="mailto:may@maywanting.wang" target="_blank"><i class="fa fa-envelope-o"></i></a><a href="http://weibo.com/[object Object]" target="_blank"><i class="fa fa-weibo"></i></a><a href="/atom.xml" target="_blank"><i class="fa fa-rss"></i></a></div><div class="footer">© 2019 <a href="/" rel="nofollow">may</a>. Powered by <a rel="nofollow" target="_blank" href="https://hexo.io">Hexo</a>. Theme <a target="_blank" href="https://github.com/lotabout/very-simple">very-simple</a>.</div></div></div></footer><link rel="stylesheet" type="text/css" href="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.css"><script src="//cdn.bootcss.com/jquery/2.0.3/jquery.min.js"></script><script src="//cdn.bootcss.com/fancybox/2.1.5/jquery.fancybox.pack.js"></script><script>$(document).ready(function() {
    $(".fancybox").fancybox();
});
</script></body></html>